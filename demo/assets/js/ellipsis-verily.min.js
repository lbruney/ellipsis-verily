(function(){!function(t){"use scrict";var s;s=function(s,e){var i;i={max:450,handler:".ellipsis-handler",visible:".visible-text",truncated:".truncated-text",ellipsis:".ellipsis-text",hiddenClass:"display-none",showClass:"display-inline",activeClass:"open",moreText:"Read more",lessText:"Show less",parent:null,normalTags:["p","span","strong","em","label","br","h1","h2","h3","h4","b","code","ul","li"],attributedTags:["a","img"]},this.options=t.extend(i,e),this.element=t(s),this.tags=this.options.normalTags.concat(this.options.attributedTags),this.normalTagCount=this.options.normalTags.length,this.attributedTagCount=this.options.attributedTags.length,this.tagsLength={},this.init()},s.prototype.init=function(){this.placeHolderTags(),this.makeEllipsis(),this.setEvents()},s.prototype.setEvents=function(){var s,e,i;i=this,this.options.parent?(e=this.element.parentsUntil(this.options.parent),s=e.length>0?e.parent():this.element.parent(),this.handler=s.find(this.options.handler)):this.handler=t(this.options.handler),this.handler.click(function(){var s;return s=t(this),s.toggleClass(i.options.activeClass),s.text(s.hasClass(i.options.activeClass)?i.options.lessText:i.options.moreText),i.element.find(i.options.ellipsis).toggleClass(i.options.hiddenClass).toggleClass(i.options.showClass),i.element.find(i.options.truncated).toggleClass(i.options.hiddenClass).toggleClass(i.options.showClass),!1})},s.prototype.placeHolderTags=function(){var t;for(this.html=this.element.html(),this.attributedTag={},t=0;t<this.normalTagCount;)this.replaceTag(this.tags[t]),t++;for(t=this.normalTagCount;t<this.normalTagCount+this.attributedTagCount;)this.replaceAttributedTag(this.tags[t]),t++;this.html=this.stripOtherTags(this.html)},s.prototype.stripOtherTags=function(t){return t.replace(/(<([^>]+)>)/gi,"")},s.prototype.replaceAttributedTag=function(s){this.attributedTag[s]=t(s),this.html=this.html.replace(this.getRegex(this.getTag(s)),this.getPlaceholderTag(s)+this.getPlaceholderTag(s,!1))},s.prototype.replaceTag=function(t){this.html=this.html.replace(this.getRegex(this.getTag(t)),this.getPlaceholderTag(t)),this.html=this.html.replace(this.getRegex(this.getTag(t,!1)),this.getPlaceholderTag(t,!1))},s.prototype.replenishTag=function(t){this.finalHtml=this.finalHtml.replace(this.getRegex(this.getPlaceholderTag(t)),this.getTag(t,!0,!0)),this.finalHtml=this.finalHtml.replace(this.getRegex(this.getPlaceholderTag(t,!1)),this.getTag(t,!1))},s.prototype.replenishAttributedTag=function(t){var s,e,i,a;for(s=0;s<this.attributedTag[t].length;)i=this.attributedTag[t][s].outerHTML,e=this.attributedTag[t][s].innerHTML,a=this.getPlaceholderTag(t)+this.getPlaceholderTag(t,!1)+e,this.finalHtml=this.finalHtml.replace(this.getRegex(a),i),s++},s.prototype.getTag=function(t,s,e){return null==s&&(s=!0),null==e&&(e=!1),s?e?"<"+t+">":"<"+t+"([^>]*)>":"</"+t+">"},s.prototype.getPlaceholderTag=function(t,s){return null==s&&(s=!0),s?"{"+t+"}":"{/"+t+"}"},s.prototype.makeEllipsis=function(){var t,s;t=5*this.getTotalTags()+this.options.max,s=this.html.indexOf(" ",t),this.half1=this.html.substr(0,s),this.half2=this.html.substr(s,this.html.length-1),this.findBreaks(),this.recreateHtml(),this.element.html(this.finalHtml)},s.prototype.findBreaks=function(){var t,s,e,i,a,h;for(i=0;i<this.normalTagCount;){if(h=this.getPlaceholderTag(this.tags[i]),a=this.countOccurrences(h),t=this.countOccurrences(this.getPlaceholderTag(this.tags[i],!1)),a>t)for(e=a-t,s=0;e>s;)this.moveToTruncated(this.half1.lastIndexOf(h)),s++;i++}},s.prototype.recreateHtml=function(){var t;for(t=0,this.finalHtml='<div class="'+this.options.visible.substr(1)+'">'+this.half1+'<span class="'+this.options.ellipsis.substr(1)+" "+this.options.showClass+'">...</span></div><div class="'+this.options.truncated.substr(1)+" "+this.options.hiddenClass+'" >'+this.half2+"</div>";t<this.normalTagCount;)this.replenishTag(this.tags[t]),t++;for(t=this.normalTagCount;t<this.normalTagCount+this.attributedTagCount;)this.replenishAttributedTag(this.tags[t]),t++},s.prototype.moveToTruncated=function(t){var s;s=this.half1.substr(t,this.half1.length-1),this.half2=s+this.half2,this.half1=this.half1.substr(0,t)},s.prototype.countOccurrences=function(t){var s;return s=this.half1.match(this.getRegex(t)),s?s.length:0},s.prototype.getRegex=function(t){return new RegExp(t,"gi")},s.prototype.getTotalTags=function(){var s,e;return s=this,e=0,t.each(this.tags,function(t,i){var a;a=s.element.find(i).length,e+=a,s.tagsLength[i]=a}),e},s.prototype.hasTag=function(t){return that.tagsLength[t]>0},t.fn.EllipsisVerily=function(e){t(this).each(function(){return t(this).data("ellipsis-verily")?void 0:t(this).data("ellipsis-verily",new s(this,e))})}}(jQuery)}).call(this);